<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  ﻿  <ModulePrefs title="Video Watcher">
    ﻿  ﻿  <Require feature="rpc" />
    ﻿  ﻿  <Require feature="views" />
    ﻿  ﻿  <Require feature="locked-domain" />
    ﻿  </ModulePrefs>
  ﻿  <Content type="html"><![CDATA[

<html>
  <style type="text/css">
  </style>
  <body>

    <script src="//plus.google.com/hangouts/_/api/v1/hangout.js"></script>

    <script>
// USE https://developers.google.com/+/hangouts/shared-state TO GET STATE TO OTHER APP USERS
// can use the events to trigger their play button with the appropriate values
// ... but we also need to get the video PLAYING in everyone's app at the same time...
// like, need to trigger a click in the iframe's body or something

      function sendUpdatedVideoState() {
        /* Function called to update state when someone enters a new URL/width/height */
        var embedUrl = document.getElementById("videoUrlInput").value;
        var embedHeight = document.getElementById("videoHeightInput").value;
        var embedWidth = document.getElementById("videoWidthInput").value;
        gapi.hangout.data.submitDelta( {
          "video_url": embedUrl,
          "video_width": embedWidth,
          "video_height": embedHeight
        } );
      }

      function init() {
        // When API is ready...
        gapi.hangout.onApiReady.add(
            function(eventObj) {
              if (eventObj.isApiReady) {
                document.getElementById('playButton')
                  .style.visibility = 'visible';
              }
            });
      }

      // Wait for gadget to load.
      gadgets.util.registerOnLoadHandler(init);
      gapi.hangout.data.onStateChanged(function (event) {
        /* Function called when state is updated */
        var state = gapi.hangout.data.getState();
        var embedUrl = state["video_url"];
        var embedWidth = state["video_width"];
        var embedHeight = state["video_height"];
        var ifr = document.getElementById("videoIframe");
        if (ifr.getAttribute("src") != embedUrl) {
          ifr.setAttribute("src", embedUrl);
        }
        ifr.setAttribute("width", embedWidth);
        ifr.setAttribute("height", embedHeight);
      });
      </script>


    <h3>Video Watcher</h3>

    <p>
      URL: <input type="text" id="videoUrlInput" />
      Width: <input type="text" id="videoWidthInput" />
      Height: <input type="text" id="videoHeightInput" />
      <input class="button" type="button" value="Play!" id="playButton"
	         style="visibility:hidden;"
	         onClick="sendUpdatedVideoState()"/>
      </p>

    <iframe id="videoIframe" />

    </body>
  ]]>
    </Content>
  </Module>

